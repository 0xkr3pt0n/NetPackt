import psycopg2

class database_vulnerability_search:
    def __init__(self):
        try:
            # Connection to the CVE database
            cve_connection = psycopg2.connect(
                host="localhost",
                database="cves",  
                user="postgres",
                password="postgres"
            )
            self.cve_connection = cve_connection
            self.cve_cursor = cve_connection.cursor()
        except Exception as e:
            print("Error connecting to database : ", e)
    def search_cpes(self, cpe):
        search_query = f"SELECT cve_id FROM cpes where cpe ilike '%{cpe}%'"
        self.cve_cursor.execute(search_query)
        cve_result = self.cve_cursor.fetchall()
        return cve_result
    
    def search_cve(self, cve):
        search_query = f"SELECT * FROM cve where cve_id = '{cve}'"
        self.cve_cursor.execute(search_query)
        cve_result = self.cve_cursor.fetchall()
        return cve_result
    
    def search_refrences(self, cve):
        search_query = f"SELECT * FROM refrences where cve_id = '{cve}'"
        self.cve_cursor.execute(search_query)
        refrences_result = self.cve_cursor.fetchall()
        return refrences_result
    
if __name__ == "__main__":
    sr = database_vulnerability_search()
    print(sr.search_cpes("http_server:2.2.8"))
    print(sr.search_cve('CVE-2011-3368'))
    print(sr.search_refrences('CVE-2011-3368'))